<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<title data-rh="true">WebAssembly | Mazzaroth</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://mazzaroth.io/docs/docs/Architecture/WebAssembly"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="WebAssembly | Mazzaroth"><meta data-rh="true" name="description" content="WebAssembly (abbreviated Wasm) is a binary instruction format"><meta data-rh="true" property="og:description" content="WebAssembly (abbreviated Wasm) is a binary instruction format"><link data-rh="true" rel="icon" href="/docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://mazzaroth.io/docs/docs/Architecture/WebAssembly"><link data-rh="true" rel="alternate" href="https://mazzaroth.io/docs/docs/Architecture/WebAssembly" hreflang="en"><link data-rh="true" rel="alternate" href="https://mazzaroth.io/docs/docs/Architecture/WebAssembly" hreflang="x-default"><link rel="stylesheet" href="/docs/assets/css/styles.a42da5ed.css">
<link rel="preload" href="/docs/assets/js/runtime~main.1e7a28cd.js" as="script">
<link rel="preload" href="/docs/assets/js/main.e898ce58.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/logo.svg" alt="Mazzaroth Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/docs/img/logo.svg" alt="Mazzaroth Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Mazzaroth</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/docs/Getting_Started">Tutorial</a><a class="navbar__item navbar__link" href="/docs/api">API Reference</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/kochavalabs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="Switch between dark and light mode (currently light mode)"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docs/Getting_Started">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docs/Account_Creation">Account Creation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/docs/Architecture/Deterministic_Logic">Architecture</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docs/Architecture/Deterministic_Logic">Deterministic Logic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docs/Architecture/XDR_Intro">eXternal Data Representation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docs/Architecture/Mazzaroth-XDR">Mazzaroth-XDR</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/docs/Architecture/WebAssembly">WebAssembly</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docs/Architecture/Storage">Storage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docs/Architecture/Data_Structures">Data Structures</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docs/Architecture/Blockchain">Blockchain</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/docs/Developer_Tools/Mazzaroth_JS">Developer Tools</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/docs/Tutorials/Install_Mazzaroth">Mazzaroth Tutorials</a></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docs/">üè†</a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">Architecture</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docs/docs/Architecture/WebAssembly">WebAssembly</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>WebAssembly</h1><p>WebAssembly (abbreviated Wasm) is a binary instruction format
for a stack-based virtual machine.
Mazzaroth uses a custom runtime to execute Wasm binaries of compiled smart contracts.</p><ul><li><a href="https://webassembly.org/" target="_blank" rel="noopener noreferrer">Website</a></li><li><a href="https://webassembly.org/docs/high-level-goals/" target="_blank" rel="noopener noreferrer">Documentation</a></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="high-level-language-support">High Level Language Support<a class="hash-link" href="#high-level-language-support" title="Direct link to heading">‚Äã</a></h2><p>Many different high-level languages like C, C++, and Rust support Wasm as a target.
By incorporating the Mazzaroth system interface these languages can be used
to write and deploy Mazzaroth Smart Contracts.</p><p>We currently support Mazzaroth Smart Contracts written in
<a href="https://github.com/rust-lang/rust" target="_blank" rel="noopener noreferrer">Rust</a> by leveraging the
<a href="https://github.com/kochavalabs/mazzaroth-rs" target="_blank" rel="noopener noreferrer">mazzaroth-rs</a> library
with support for more languages on the horizon.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="wasm-runtime">Wasm Runtime<a class="hash-link" href="#wasm-runtime" title="Direct link to heading">‚Äã</a></h2><p>Contracts are compiled to WebAssembly bytecode which are loaded and executed in
a custom WebAssembly (Wasm) virtual machine used by Mazzaroth.
The runtime is a memory-safe sandbox execution environment which allows for a
deterministic execution of functions that are defined within a Wasm binary.
This runtime can be embedded with a custom system interface to
provide access to memory or other outside resources.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="rothvm">RothVM<a class="hash-link" href="#rothvm" title="Direct link to heading">‚Äã</a></h2><p>The Mazzaroth Virtual Machine (RothVM) is the execution environment that embeds
the Wasm runtime and extends it with a system interface providing host functions
that give Smart Contracts a way to interact with persistent state on the blockchain.
Every Mazzaroth Node contains an instance of RothVM in which to execute transactions.
Transactions may set the Wasm module by performing a contract update,
or execute a function on the module with a Call transaction.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="system-interface">System Interface<a class="hash-link" href="#system-interface" title="Direct link to heading">‚Äã</a></h3><p>RothVM Supports a set of functions for interacting with the system during the
WebAssembly runtime. It is possible to write contracts that take advantage of
this system interface by using a Mazzaroth library such as
<a href="https://github.com/kochavalabs/mazzaroth-rs" target="_blank" rel="noopener noreferrer">mazzaroth-rs</a> for Rust.</p><p>The following is a list of the System Interface functions available through
RothVM environment and how they can be used by the Wasm module:</p><table><thead><tr><th>Name</th><th>Params</th><th>Returns</th><th>Description</th></tr></thead><tbody><tr><td>_fetch_input</td><td>i32</td><td></td><td>Copies the input arguments to memory at the specified pointer location. Should call _input_length first to get the length of input to allocate enough space in WASM memory.</td></tr><tr><td>_input_length</td><td></td><td>i32</td><td>Returns the length of the input arguments passed to a function call.</td></tr><tr><td>_ret</td><td>i32, i32</td><td></td><td>Provides the return value of a function call stored in memory. First param is the memory location of the stored return value, second is the length.</td></tr><tr><td>_store</td><td>i32, i32, i32, i32</td><td></td><td>Stores a key and value in the Contract State DB. First two params describe the key: pointer to memory and length. Second two params describe the value: pointer to memory and length.</td></tr><tr><td>_<!-- -->get</td><td>i32, i32, i32</td><td></td><td>Gets a value from the Contract State DB by providing a key (pointer and length) and the pointer describing where to copy the value. Should call _get_length first to get the length of the return value to allocate space in memory.</td></tr><tr><td>_get_length</td><td>i32, i32</td><td>i32</td><td>Returns the length of the value returned for when getting a value from the State DB for a provided key. The first param is the pointer to the key in memory, followed by the key length. The return is the length of memory needed to store the value returned.</td></tr><tr><td>_delete</td><td>i32, i32</td><td></td><td>Deletes the provided key from the State DB. Params are the pointer to the key in memory, followed by the key length.</td></tr><tr><td>_key_exists</td><td>i32, i32</td><td>i32</td><td>Returns whether the provided keys exists in the Contract State DB. Params are the pointer to the key in memory, followed by the key length. Returns 1 if they key exists, 0 if it does not.</td></tr><tr><td>_get_account<!-- -->_<!-- -->name</td><td>i32, i32, i32</td><td></td><td>Gets the name of an Account within the Contract State DB. The first two params are the pointer and length of memory to get the account key. The third param is the pointer in memory to copy the account name. Should call _get_account_name_length first to get the length of the name to allocate space in memory.</td></tr><tr><td>_get_account_name_length</td><td>i32, i32</td><td>i32</td><td>Returns the length of account name for a provided account key store in the Contract State DB.</td></tr><tr><td>_set_account_name</td><td>i32, i32, i32, i32</td><td></td><td>Sets the account name for a given account key in the Contract State DB. The first two params describe the pointer and length of the key in memory. The second two params describe the pointer and length of the name to set for the account key.</td></tr><tr><td>_is_owner</td><td>i32, i32</td><td>i32</td><td>Returns whether the provided account key is the owner of the contract. The params describe the pointer and length of account key in memory. The return value is a 1 if the given key is the owner or 0 otherwise.</td></tr><tr><td>_kq_json_insert</td><td>i32, i32, i32, i32</td><td>i32</td><td>Inserts data into a specified table in the Contract State DB, based on provided JSON. The first two params provided the pointer and length of the table name. The second two params provide the pointer and length of the json query string. Returns 0 if the insert was successful.</td></tr><tr><td>_kq_query_run</td><td>i32, i32, i32</td><td>i32</td><td>Run a query against the Contract State DB and return the hash key to lookup result. The first two params provided the pointer and length of the query. The third param provide the pointer in memory to store the hash (16 bytes should be allocated). Returns the length of the query result know how much space in memory to allocate before fetch.</td></tr><tr><td>_kq_query_fetch</td><td>i32, i32</td><td></td><td>Gets the result of query that was run against the Contract State DB by providing the hash for lookup.</td></tr><tr><td>_log</td><td>i32, i32</td><td></td><td>Writes a given message to the RothVM log location. The parameters describe the pointer and length of the message store in memory.</td></tr><tr><td>_log_error</td><td>i32, i32</td><td></td><td>Return an error message to RothVM. The parameters describe the pointer and length of the error message store in memory.</td></tr></tbody></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/kochavalabs/docs/tree/main/../docs/3-Architecture/4-WebAssembly.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/docs/Architecture/Mazzaroth-XDR"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Mazzaroth-XDR</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/docs/Architecture/Storage"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Storage</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#high-level-language-support" class="table-of-contents__link toc-highlight">High Level Language Support</a></li><li><a href="#wasm-runtime" class="table-of-contents__link toc-highlight">Wasm Runtime</a></li><li><a href="#rothvm" class="table-of-contents__link toc-highlight">RothVM</a><ul><li><a href="#system-interface" class="table-of-contents__link toc-highlight">System Interface</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/docs/Getting_Started">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/kochavaofficial" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/kochavalabs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 Mazzaroth</div></div></div></footer></div>
<script src="/docs/assets/js/runtime~main.1e7a28cd.js"></script>
<script src="/docs/assets/js/main.e898ce58.js"></script>
</body>
</html>