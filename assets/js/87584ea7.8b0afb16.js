"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[889],{3905:function(t,e,n){n.d(e,{Zo:function(){return m},kt:function(){return c}});var a=n(7294);function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function o(t,e){if(null==t)return{};var n,a,r=function(t,e){if(null==t)return{};var n,a,r={},l=Object.keys(t);for(a=0;a<l.length;a++)n=l[a],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)n=l[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}var s=a.createContext({}),u=function(t){var e=a.useContext(s),n=e;return t&&(n="function"==typeof t?t(e):i(i({},e),t)),n},m=function(t){var e=u(t.components);return a.createElement(s.Provider,{value:e},t.children)},h={inlineCode:"code",wrapper:function(t){var e=t.children;return a.createElement(a.Fragment,{},e)}},p=a.forwardRef((function(t,e){var n=t.components,r=t.mdxType,l=t.originalType,s=t.parentName,m=o(t,["components","mdxType","originalType","parentName"]),p=u(n),c=r,d=p["".concat(s,".").concat(c)]||p[c]||h[c]||l;return n?a.createElement(d,i(i({ref:e},m),{},{components:n})):a.createElement(d,i({ref:e},m))}));function c(t,e){var n=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var l=n.length,i=new Array(l);i[0]=p;var o={};for(var s in e)hasOwnProperty.call(e,s)&&(o[s]=e[s]);o.originalType=t,o.mdxType="string"==typeof t?t:r,i[1]=o;for(var u=2;u<l;u++)i[u]=n[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},165:function(t,e,n){n.r(e),n.d(e,{assets:function(){return m},contentTitle:function(){return s},default:function(){return c},frontMatter:function(){return o},metadata:function(){return u},toc:function(){return h}});var a=n(7462),r=n(3366),l=(n(7294),n(3905)),i=["components"],o={},s="WebAssembly",u={unversionedId:"Architecture/WebAssembly",id:"Architecture/WebAssembly",title:"WebAssembly",description:"WebAssembly (abbreviated Wasm) is a binary instruction format",source:"@site/../docs/3-Architecture/4-WebAssembly.md",sourceDirName:"3-Architecture",slug:"/Architecture/WebAssembly",permalink:"/docs/docs/Architecture/WebAssembly",editUrl:"https://github.com/kochavalabs/docs/tree/main/../docs/3-Architecture/4-WebAssembly.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"eXternal Data Representation",permalink:"/docs/docs/Architecture/XDR_Intro"},next:{title:"Storage",permalink:"/docs/docs/Architecture/Storage"}},m={},h=[{value:"High Level Language Support",id:"high-level-language-support",level:2},{value:"Wasm Runtime",id:"wasm-runtime",level:2},{value:"RothVM",id:"rothvm",level:2},{value:"System Interface",id:"system-interface",level:3}],p={toc:h};function c(t){var e=t.components,n=(0,r.Z)(t,i);return(0,l.kt)("wrapper",(0,a.Z)({},p,n,{components:e,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"webassembly"},"WebAssembly"),(0,l.kt)("p",null,"WebAssembly (abbreviated Wasm) is a binary instruction format\nfor a stack-based virtual machine.\nMazzaroth uses a custom runtime to execute Wasm binaries of compiled smart contracts."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://webassembly.org/"},"Website")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://webassembly.org/docs/high-level-goals/"},"Documentation"))),(0,l.kt)("h2",{id:"high-level-language-support"},"High Level Language Support"),(0,l.kt)("p",null,"Many different high-level languages like C, C++, and Rust support Wasm as a target.\nBy incorporating the Mazzaroth system interface these languages can be used\nto write and deploy Mazzaroth Smart Contracts."),(0,l.kt)("p",null,"We currently support Mazzaroth Smart Contracts written in\n",(0,l.kt)("a",{parentName:"p",href:"https://github.com/rust-lang/rust"},"Rust")," by leveraging the\n",(0,l.kt)("a",{parentName:"p",href:"https://github.com/kochavalabs/mazzaroth-rs"},"mazzaroth-rs")," library\nwith support for more languages on the horizon."),(0,l.kt)("h2",{id:"wasm-runtime"},"Wasm Runtime"),(0,l.kt)("p",null,"Contracts are compiled to WebAssembly bytecode which are loaded and executed in\na custom WebAssembly (Wasm) virtual machine used by Mazzaroth.\nThe runtime is a memory-safe sandbox execution environment which allows for a\ndeterministic execution of functions that are defined within a Wasm binary.\nThis runtime can be embedded with a custom system interface to\nprovide access to memory or other outside resources."),(0,l.kt)("h2",{id:"rothvm"},"RothVM"),(0,l.kt)("p",null,"The Mazzaroth Virtual Machine (RothVM) is the execution environment that embeds\nthe Wasm runtime and extends it with a system interface providing host functions\nthat give Smart Contracts a way to interact with persistent state on the blockchain.\nEvery Mazzaroth Node contains an instance of RothVM in which to execute transactions.\nTransactions may set the Wasm module by performing a contract update,\nor execute a function on the module with a Call transaction."),(0,l.kt)("h3",{id:"system-interface"},"System Interface"),(0,l.kt)("p",null,"RothVM Supports a set of functions for interacting with the system during the\nWebAssembly runtime. It is possible to write contracts that take advantage of\nthis system interface by using a Mazzaroth library such as\n",(0,l.kt)("a",{parentName:"p",href:"https://github.com/kochavalabs/mazzaroth-rs"},"mazzaroth-rs")," for Rust."),(0,l.kt)("p",null,"The following is a list of the System Interface functions available through\nRothVM environment and how they can be used by the Wasm module:"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Params"),(0,l.kt)("th",{parentName:"tr",align:null},"Returns"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"_fetch_input"),(0,l.kt)("td",{parentName:"tr",align:null},"i32"),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},"Copies the input arguments to memory at the specified pointer location. Should call _input_length first to get the length of input to allocate enough space in WASM memory.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"_input_length"),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},"i32"),(0,l.kt)("td",{parentName:"tr",align:null},"Returns the length of the input arguments passed to a function call.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"_ret"),(0,l.kt)("td",{parentName:"tr",align:null},"i32, i32"),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},"Provides the return value of a function call stored in memory. First param is the memory location of the stored return value, second is the length.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"_store"),(0,l.kt)("td",{parentName:"tr",align:null},"i32, i32, i32, i32"),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},"Stores a key and value in the Contract State DB. First two params describe the key: pointer to memory and length. Second two params describe the value: pointer to memory and length.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"_","get"),(0,l.kt)("td",{parentName:"tr",align:null},"i32, i32, i32"),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},"Gets a value from the Contract State DB by providing a key (pointer and length) and the pointer describing where to copy the value. Should call _get_length first to get the length of the return value to allocate space in memory.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"_get_length"),(0,l.kt)("td",{parentName:"tr",align:null},"i32, i32"),(0,l.kt)("td",{parentName:"tr",align:null},"i32"),(0,l.kt)("td",{parentName:"tr",align:null},"Returns the length of the value returned for when getting a value from the State DB for a provided key. The first param is the pointer to the key in memory, followed by the key length. The return is the length of memory needed to store the value returned.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"_delete"),(0,l.kt)("td",{parentName:"tr",align:null},"i32, i32"),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},"Deletes the provided key from the State DB. Params are the pointer to the key in memory, followed by the key length.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"_key_exists"),(0,l.kt)("td",{parentName:"tr",align:null},"i32, i32"),(0,l.kt)("td",{parentName:"tr",align:null},"i32"),(0,l.kt)("td",{parentName:"tr",align:null},"Returns whether the provided keys exists in the Contract State DB. Params are the pointer to the key in memory, followed by the key length. Returns 1 if they key exists, 0 if it does not.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"_get_account","_","name"),(0,l.kt)("td",{parentName:"tr",align:null},"i32, i32, i32"),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},"Gets the name of an Account within the Contract State DB. The first two params are the pointer and length of memory to get the account key. The third param is the pointer in memory to copy the account name. Should call _get_account_name_length first to get the length of the name to allocate space in memory.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"_get_account_name_length"),(0,l.kt)("td",{parentName:"tr",align:null},"i32, i32"),(0,l.kt)("td",{parentName:"tr",align:null},"i32"),(0,l.kt)("td",{parentName:"tr",align:null},"Returns the length of account name for a provided account key store in the Contract State DB.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"_set_account_name"),(0,l.kt)("td",{parentName:"tr",align:null},"i32, i32, i32, i32"),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},"Sets the account name for a given account key in the Contract State DB. The first two params describe the pointer and length of the key in memory. The second two params describe the pointer and length of the name to set for the account key.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"_is_owner"),(0,l.kt)("td",{parentName:"tr",align:null},"i32, i32"),(0,l.kt)("td",{parentName:"tr",align:null},"i32"),(0,l.kt)("td",{parentName:"tr",align:null},"Returns whether the provided account key is the owner of the contract. The params describe the pointer and length of account key in memory. The return value is a 1 if the given key is the owner or 0 otherwise.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"_kq_json_insert"),(0,l.kt)("td",{parentName:"tr",align:null},"i32, i32, i32, i32"),(0,l.kt)("td",{parentName:"tr",align:null},"i32"),(0,l.kt)("td",{parentName:"tr",align:null},"Inserts data into a specified table in the Contract State DB, based on provided JSON. The first two params provided the pointer and length of the table name. The second two params provide the pointer and length of the json query string. Returns 0 if the insert was successful.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"_kq_query_run"),(0,l.kt)("td",{parentName:"tr",align:null},"i32, i32, i32"),(0,l.kt)("td",{parentName:"tr",align:null},"i32"),(0,l.kt)("td",{parentName:"tr",align:null},"Run a query against the Contract State DB and return the hash key to lookup result. The first two params provided the pointer and length of the query. The third param provide the pointer in memory to store the hash (16 bytes should be allocated). Returns the length of the query result know how much space in memory to allocate before fetch.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"_kq_query_fetch"),(0,l.kt)("td",{parentName:"tr",align:null},"i32, i32"),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},"Gets the result of query that was run against the Contract State DB by providing the hash for lookup.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"_log"),(0,l.kt)("td",{parentName:"tr",align:null},"i32, i32"),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},"Writes a given message to the RothVM log location. The parameters describe the pointer and length of the message store in memory.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"_log_error"),(0,l.kt)("td",{parentName:"tr",align:null},"i32, i32"),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},"Return an error message to RothVM. The parameters describe the pointer and length of the error message store in memory.")))))}c.isMDXComponent=!0}}]);